---
title: Region Proposal by Guided Anchoring
tags: 2020-8-26
renderNumberedHeading: true
grammar_cjkRuby: true
---

## 摘要总结

 1. 总结了之前使用的anchor-based方法，发现其不够高效和有用，因为产生了非常密集的anchor，但是大部分是负样本；
 2. 本文首先*预测目标的位置*，然后*预测该位置的anchor形状*，然后使用特征适应模块减少特征的不连续性；
 3. 研究发现了高质量的proposals可以改变检测器的性能；
 4. 提出的Guided-anchor方法能够无缝地整合进双阶段和多阶段检测器中，在MS COCO上面实现9.1%的recall，但是anchor数量却少了将近90%；



## 引言总结

 1. anchor设计需要遵循两个基本的规则：
    **对齐**：anchor中心需要特征图上面的像素对齐；
	**一致性**：在特征图不同位置上的anchor形状和尺寸应该和视野域和语义范围一致；
 2. 基于滑窗的方法是满足这两个条件的最简单的方法；
 3. 传统的基于滑窗的方法存在两个困难：
     **不够灵活**：固定尺寸的anchor需要针对不同的问题提前设置，若是设置不合理时，就会阻碍检测器的表现；
	 **anchor数量多**：为了维持比较高的recall，需要许多的anchor，其中大量为false anchor,增加了计算量；
 4. **灵感产生**：由于目标不是均匀的分布在图片上，所以不需要在图片上的每个位置都产生anchor，只需要在存在目标的地方产生anchor就可以；目标尺寸与图片内容、目标位置以及场景的几何形状有关。
 5. *本方法的步骤*：
     **识别可能包含目标的子区域**
	 **决定不同位置的形状**
 6. 提出的方法需要解决的问题
    **一致性问题**：由于anchor的形状和尺寸不固定，打破了之前提出的一致性要求，必须使用一种新的方法来学习anchor的特征表示；
	**非对齐问题**：提出特征适应模块使特征图上的像素根据anchor形状和anchor对齐；
 7. 主要贡献
     **提出了一种新的anchor方案，能够预测任意形状的anchor**
	 **使用两个条件向量分布表示联合anchor分布，使用两个模块分别生成这两个条件向量**
	 **将特征图和anchor对齐，设计了一种特征适应模块**
	 **试验了高品质的候选框对于两阶段或者多阶段检测器的重要性**
	 
## Guided Anchoring
 
  1. 在本文中，将一个目标的位置和形状向量化为一个4维的向量（x,y,w,h），（x,y）表示目标的中心位置，（w,h）表示目标的宽和高；对于任何一张图片I，目标的位置和形状遵循下面的分布；
        ![位置和形状遵循的分布函数](https://raw.githubusercontent.com/EwardJohn/noteofyk/master/img/2020827/guided_anchor_分布函数.png)
	 *对于任何一张图，目标可能只存在于确定的区域*
	 *一个目标的形状与其位置紧密相关*
   2. 对于这个分布函数，设计了一个anchor产生模块，该模块由两个分支组成，一个分支用来进行定位目标的位置，另外一个用来生成目标形状的anchor；如下图所示：
      ![生成anchor示意图](https://raw.githubusercontent.com/EwardJohn/noteofyk/master/img/2020827/1598494273925.png)
	  图片提取特征=>位置预测分支产生概率图指出目标可能存在的位置=>形状预测分支预测基于位置的形状=>最后由这两个分支得到anchor输出

   *通过选取给定可能性阈值之上的位置处的目标，并选取该位置处最可能的形状作为anchor*
   **由于anchor形状可以产生变化，所以不同位置的特征应该抓住不同范围内的视觉内容，因此设计了一个特征适应模块，根据anchor形状调整特征图**

## Anchor 位置预测

 1. 对于特征图![enter description here](https://raw.githubusercontent.com/EwardJohn/noteofyk/master/img/2020827/1598495966207.png)anchor 位置预测分支产生和输入特征图一样尺寸的概率图![enter description here](./images/1598496066761.png)，对于每一个位置的概率值P(i,j|FI),表示在特征图上面中心坐标位置为((i+0.5)s,(j+0.5)s)的概率，表示一个目标中心存在在那个位置的可能性；
 2. 上面提到的概率值是由一个子网络![enter description here](./images/1598496633781.png)产生的，该网络对于基本特征图使用1x1卷积获得目标分数图，然后使用**sigmoid函数**将目标分数值转换成可能值；在这里实验性地发现一层卷积层+sigmoid函数能够产生精度和效率地平衡；
   
   